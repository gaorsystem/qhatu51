<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qhatu51 - Cat√°logo de Tecnolog√≠a</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* 
         * =============================================
         * Design System: Variables & Reset
         * =============================================
        */
        :root {
            --primary-color: #006edb;
            --primary-hover: #005bb4;
            --secondary-color: #ffffff;
            --price-color: #595959;
            --price-old-color: #9e9e9e;
            --text-color-dark: #212529;
            --text-color-light: #6c757d;
            --background-color: #f8f9fa;
            --border-color: #dee2e6;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --sale-badge-bg: #e44d26;
            --font-family-base: 'Open Sans', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-family-base);
            font-size: 14px;
            background-color: var(--background-color);
            color: var(--text-color-dark);
            padding-top: 80px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 40px;
        }
        
        /* 
         * =============================================
         * Navigation Bar
         * =============================================
        */
        .navbar {
            background-color: var(--secondary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 0 40px;
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 999;
        }
        .nav-brand {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }
        .nav-actions { display: flex; gap: 25px; }
        .nav-action-btn {
            position: relative;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-color-dark);
            padding: 5px;
        }
        .nav-action-btn svg {
            width: 28px;
            height: 28px;
        }
        .nav-counter {
            position: absolute;
            top: -5px; right: -10px;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border-radius: 50%;
            width: 22px; height: 22px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: scale(0);
            transition: transform 0.2s ease-out;
        }
        .nav-counter.visible { transform: scale(1); }

        /* 
         * =============================================
         * Hero Slider / Banner
         * =============================================
        */
        .slider-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin-bottom: 40px;
            overflow: hidden;
            background: #e9ecef;
        }
        .slider-wrapper {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .slide {
            flex: 0 0 100%;
            width: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 450px;
            padding: 40px;
            background: linear-gradient(45deg, #e9ecef, #dee2e6);
        }
        .slide-content {
            text-align: center;
            z-index: 2;
            color: var(--text-color-dark);
        }
        .slide-emoji {
            font-size: 150px;
            line-height: 1;
        }
        .slide-title {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
        }
        .slide-description {
            font-size: 1.1rem;
            color: var(--text-color-light);
            max-width: 500px;
            margin: 0 auto 30px;
        }
        .slider-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            background: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.2s;
        }
        .slider-nav:hover { background: var(--secondary-color); }
        .slider-nav.prev { left: 20px; }
        .slider-nav.next { right: 20px; }
        .slider-nav svg { width: 24px; height: 24px; color: var(--text-color-dark); }
        .slider-dots {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .dot.active { background-color: var(--primary-color); }
        
        /* 
         * =============================================
         * Header & Page Title
         * =============================================
        */
        header {
            text-align: center;
            padding: 40px 0 60px;
        }
        header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 8px; }
        header p { font-size: 1.1rem; color: var(--text-color-light); max-width: 600px; margin: 0 auto; }

        /* 
         * =============================================
         * Product Grid & Cards (NEW ANIMATION DESIGN)
         * =============================================
        */
        .productos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }

        .producto-card {
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .producto-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.07);
        }

        .producto-imagen-wrapper {
            position: relative;
            background-color: #f0f0f0;
            padding: 20px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            cursor: pointer;
        }
        .producto-imagen {
            font-size: 100px;
            transition: transform 0.3s ease;
        }
        .producto-card:hover .producto-imagen {
            transform: scale(1.05);
        }
        .producto-oferta-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background-color: var(--sale-badge-bg);
            color: var(--secondary-color);
            padding: 5px 10px;
            font-size: 0.8rem;
            font-weight: 700;
            border-radius: 4px;
            text-transform: uppercase;
        }
        
        .producto-content-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .producto-info {
            padding: 25px;
            text-align: left;
            transition: transform 0.3s ease-in-out;
            background: var(--secondary-color);
        }

        .producto-acciones-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70px;
            padding: 0 25px;
            background-color: var(--secondary-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
        }

        .producto-card:hover .producto-info {
             transform: translateY(-70px);
        }
        .producto-card:hover .producto-acciones-panel {
            transform: translateY(0);
        }
        
        .acciones-panel-icons {
            display: flex;
            gap: 5px;
        }

        .acciones-panel-btn {
             background: transparent;
             border: 1px solid var(--border-color);
             width: 40px;
             height: 40px;
             border-radius: 50%;
             cursor: pointer;
             display: flex;
             align-items: center;
             justify-content: center;
             color: var(--text-color-light);
             transition: all 0.2s ease;
        }
        .acciones-panel-btn svg {
            width: 20px;
            height: 20px;
        }

        .acciones-panel-btn:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--secondary-color);
        }

        .btn-add-cart-panel {
            flex-grow: 1;
            font-size: 13px;
            padding: 10px;
            text-transform: uppercase;
            font-weight: 600;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .btn-add-cart-panel:hover {
            background-color: var(--primary-hover);
        }


        .producto-marca {
            font-size: 0.9rem;
            color: var(--text-color-light);
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .producto-titulo {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-color-dark);
            cursor: pointer;
        }
        .producto-titulo:hover {
            color: var(--primary-color);
        }

        .producto-precio-wrapper {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .producto-precio {
            color: var(--price-color);
        }
        .producto-precio-anterior {
            color: var(--price-old-color);
            text-decoration: line-through;
            font-size: 1.1rem;
        }

        /* Fly to cart animation */
        .flying-image {
            position: fixed;
            z-index: 1001;
            font-size: 50px;
            transition: left 0.6s cubic-bezier(0.25, 1, 0.5, 1), top 0.6s cubic-bezier(0.25, 1, 0.5, 1), transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            pointer-events: none;
        }

        /* 
         * =============================================
         * Buttons
         * =============================================
        */
        .btn {
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            border: 2px solid transparent;
            width: 100%;
        }
        .btn-primary { background-color: var(--primary-color); color: var(--secondary-color); border-color: var(--primary-color); }
        .btn-primary:hover { background-color: var(--primary-hover); border-color: var(--primary-hover); }
        .btn-outline { background-color: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); }
        .btn-outline:hover { background-color: var(--primary-color); color: var(--secondary-color); }
        .btn-back {
            background: none;
            border: none;
            width: 40px; height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--text-color-light);
            transition: color 0.2s;
        }
        .btn-back:hover { color: var(--text-color-dark); }
        .btn-back svg { width: 24px; height: 24px; }

        /* 
         * =============================================
         * Modal Styles
         * =============================================
        */
        .modal {
            display: none; position: fixed;
            z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center; justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: var(--secondary-color);
            padding: 30px; border-radius: 8px;
            width: 90%; max-width: 900px;
            position: relative;
            animation: slide-up 0.3s ease-out;
            max-height: 90vh;
            display: flex; flex-direction: column;
        }
        .modal-content.size-md { max-width: 700px; }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-close {
            position: absolute; top: 15px; right: 20px;
            color: #aaa; font-size: 28px;
            font-weight: bold; cursor: pointer;
            background: none; border: none;
        }
        .modal-close:hover { color: var(--text-color-dark); }
        .modal-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .modal-titulo { font-size: 1.8rem; font-weight: 700; margin-bottom: 0; }
        .modal-header .nav-action-btn { font-size: 2rem; }

        /* 
         * =============================================
         * Product Detail Modal / "Quick View"
         * =============================================
        */
        .detalle-modal-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; max-height: calc(90vh - 120px); overflow-y: auto; padding: 5px; }
        .detalle-galeria { display: flex; flex-direction: column; gap: 15px; }
        .imagen-principal { background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 8px; height: 400px; display: flex; align-items: center; justify-content: center; font-size: 150px; }
        .miniatura-lista { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; }
        .miniatura-item { border: 2px solid var(--border-color); border-radius: 5px; height: 80px; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; transition: border-color 0.2s; }
        .miniatura-item.active, .miniatura-item:hover { border-color: var(--primary-color); }
        .detalle-info .producto-precio-wrapper { font-size: 2.2rem; }
        .detalle-info .producto-acciones { margin-top: 30px; opacity: 1; transform: translateY(0); position: static; display: flex; gap: 10px; }
        .detalle-info .producto-acciones .btn { width: 100%; }
        .detalle-descripcion-larga { margin-top: 20px; line-height: 1.7; color: var(--text-color-light); }
        .detalle-especificaciones { margin-top: 30px; }
        .detalle-especificaciones h4 { font-size: 16px; font-weight: 700; margin-bottom: 15px; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; }
        .detalle-especificaciones ul { list-style: none; }
        .detalle-especificaciones li { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        .detalle-especificaciones li:last-child { border-bottom: none; }
        .detalle-especificaciones strong { color: var(--text-color-dark); }
        @media (max-width: 800px) { .detalle-modal-layout { grid-template-columns: 1fr; } .imagen-principal { height: 300px; font-size: 100px; } }

        /* Cart & Quote List Styles */
        .lista-items { overflow-y: auto; max-height: 350px; padding-right: 10px; margin-bottom: 20px; }
        .lista-item { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 20px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        .lista-item:last-child { border-bottom: none; }
        .item-emoji { font-size: 4rem; }
        .item-info h4 { font-weight: 600; font-size: 16px; }
        .item-info p { color: var(--text-color-light); font-size: 14px; }
        .item-controles { display: flex; align-items: center; gap: 15px; }
        .cantidad-control { display: flex; align-items: center; border: 1px solid var(--border-color); border-radius: 5px; }
        .cantidad-btn { background: none; border: none; width: 30px; height: 30px; cursor: pointer; color: var(--text-color-light); display: flex; align-items: center; justify-content: center; }
        .cantidad-btn svg { width: 16px; height: 16px; }
        .cantidad-btn:hover { color: var(--text-color-dark); }
        .cantidad-input { width: 40px; text-align: center; border: none; font-size: 1rem; font-weight: 600; appearance: textfield; background: transparent; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .item-precio { width: 100px; text-align: right; font-weight: 700; font-size: 1.1rem; }
        .item-remove-btn { background: none; border: none; color: var(--danger-color); cursor: pointer; opacity: 0.6; padding: 5px; }
        .item-remove-btn svg { width: 20px; height: 20px; }
        .item-remove-btn:hover { opacity: 1; }
        .lista-footer { margin-top: auto; padding-top: 20px; border-top: 2px solid var(--text-color-dark); display: flex; justify-content: space-between; align-items: center; }
        .lista-total h3 { font-size: 1.5rem; }
        .lista-total p { font-size: 1.1rem; color: var(--text-color-light); }
        .lista-acciones-footer { display: flex; gap: 15px; }
        .lista-acciones-footer .btn { width: auto; }
        .lista-vacia { text-align: center; padding: 40px; color: var(--text-color-light); }
        .lista-vacia-icon { color: var(--border-color); margin-bottom: 1rem; }
        .lista-vacia-icon svg { width: 80px; height: 80px; }
        .lista-vacia p { font-size: 1.2rem; }

        /* Form Styles */
        .form-container { overflow-y: auto; max-height: calc(90vh - 150px); padding-right: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: var(--text-color-dark); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 5px; font-size: 1rem; font-family: var(--font-family-base); }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 110, 219, 0.15); }
        .metodo-pago-info { background-color: var(--background-color); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .metodo-pago-info h4 { font-size: 1.2rem; font-weight: 700; margin-bottom: 15px; text-align: center; }
        .qr-container { text-align: center; }
        .qr-placeholder { width: 180px; height: 180px; background: var(--secondary-color); border: 2px dashed var(--border-color); border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto 15px; color: var(--text-color-light); }
        .qr-placeholder svg { width: 40px; height: 40px; margin-bottom: 10px; }
        .qr-container p { line-height: 1.6; }
        .cuenta-info { background: var(--secondary-color); padding: 15px; border-radius: 5px; margin-bottom: 10px; }
        .cuenta-info strong { color: var(--primary-color); display: block; margin-bottom: 5px; }
        .loading, .success-message { text-align: center; padding: 40px 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .success-icon { font-size: 60px; color: var(--success-color); margin-bottom: 15px; }
    </style>
</head>
<body>
    
    <nav class="navbar">
        <a href="#" class="nav-brand">Qhatu51</a>
        <div class="nav-actions">
            <button class="nav-action-btn" data-action="open-cart" aria-label="Abrir carrito de compras">
                <span id="nav-cart-icon"></span>
                <span class="nav-counter" id="cart-counter">0</span>
            </button>
            <button class="nav-action-btn" data-action="open-quote" aria-label="Abrir lista de cotizaci√≥n">
                <span id="nav-quote-icon"></span>
                <span class="nav-counter" id="quote-counter">0</span>
            </button>
        </div>
    </nav>

    <div class="slider-container" id="hero-slider">
        <div class="slider-wrapper">
            <!-- Slides will be injected by JS -->
        </div>
        <button class="slider-nav prev" aria-label="Anterior">${ICONS.back}</button>
        <button class="slider-nav next" aria-label="Siguiente"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></button>
        <div class="slider-dots">
            <!-- Dots will be injected by JS -->
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1>Nuestra Colecci√≥n</h1>
            <p>Descubre productos de vanguardia dise√±ados para tu estilo de vida.</p>
        </header>
        
        <main>
            <div class="productos-grid" id="productosGrid"></div>
        </main>
    </div>

    <!-- Modal Gen√©rico -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modal-content">
            <!-- Contenido din√°mico aqu√≠ -->
        </div>
    </div>

    <script>
        // =============================================
        // SVG ICONS
        // =============================================
        const ICONS = {
            cart: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>',
            quote: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>',
            quickView: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>',
            trash: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>',
            plus: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
            minus: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>',
            back: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',
            bag: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-2z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>',
            qr: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect><line x1="14" y1="14" x2="14" y2="21"></line><line x1="21" y1="14" x2="21" y2="21"></line><line x1="17.5" y1="17.5" x2="17.5" y2="17.5"></line></svg>',
        };


        // =============================================
        // CONFIGURACI√ìN
        // =============================================
        const CONFIG = {
            n8nWebhookCompra: 'https://your-n8n-instance.com/webhook/compra',
            n8nWebhookCotizacion: 'https://your-n8n-instance.com/webhook/cotizacion',
        };

        const PRODUCTS = [
            { id: 1, marca: "TechCorp", nombre: 'Laptop Premium', precio: 2500.00, precioAnterior: 3000.00, oferta: "-17%", emoji: 'üíª', imagenes: ['üíª', 'üñ•Ô∏è', '‚å®Ô∏è'], descripcionLarga: 'Experimenta un rendimiento sin precedentes con nuestro port√°til premium. Equipado con los √∫ltimos procesadores, una pantalla vibrante y un dise√±o elegante y ligero, es la herramienta perfecta tanto para profesionales creativos como para ejecutivos en movimiento.', especificaciones: [{key: 'Procesador', value: 'Intel Core i9'}, {key: 'RAM', value: '32GB DDR5'}, {key: 'Almacenamiento', value: '1TB NVMe SSD'}, {key: 'Pantalla', value: '16" 4K OLED'}] },
            { id: 2, marca: "ConnectPro", nombre: 'Smartphone Pro', precio: 1500.00, emoji: 'üì±', imagenes: ['üì±', 'ü§≥', 'üì∏'], descripcionLarga: 'Captura el mundo con un detalle asombroso con la c√°mara de 108MP y navega a la velocidad de la luz con 5G. Su pantalla ProMotion y el chip A16 Bionic ofrecen una experiencia de usuario incre√≠blemente fluida.', especificaciones: [{key: 'C√°mara Principal', value: '108MP'}, {key: 'Pantalla', value: '6.7" Super Retina XDR'}, {key: 'Bater√≠a', value: '4352 mAh'}, {key: 'Conectividad', value: '5G'}] },
            { id: 3, marca: "AudioPhonic", nombre: 'Auriculares Bluetooth', precio: 350.00, precioAnterior: 450.00, oferta: "OFERTA", emoji: 'üéß', imagenes: ['üéß', 'üé∂', 'üé§'], descripcionLarga: 'Sum√©rgete en tu m√∫sica con nuestra cancelaci√≥n de ruido activa l√≠der en la industria. Disfruta de hasta 30 horas de reproducci√≥n ininterrumpida y un confort excepcional para llevarlos todo el d√≠a.', especificaciones: [{key: 'Cancelaci√≥n de Ruido', value: 'Activa Adaptativa'}, {key: 'Autonom√≠a', value: '30 horas'}, {key: 'Conectividad', value: 'Bluetooth 5.2'}, {key: 'Drivers', value: '40mm Neodimio'}] },
            { id: 4, marca: "PixelPad", nombre: 'Tablet Digital', precio: 800.00, emoji: 'üìù', imagenes: ['üìù', 'üé®', '‚úçÔ∏è'], descripcionLarga: 'Libera tu creatividad con nuestra tablet digital. Su pantalla Liquid Retina y la compatibilidad con nuestro l√°piz de precisi√≥n la convierten en el lienzo perfecto para artistas, dise√±adores y estudiantes.', especificaciones: [{key: 'Pantalla', value: '11" Liquid Retina'}, {key: 'Procesador', value: 'Chip M2'}, {key: 'L√°piz', value: '2da Generaci√≥n'}, {key: 'Almacenamiento', value: '256GB'}] },
            { id: 5, marca: "FitTrack", nombre: 'Smartwatch', precio: 450.00, emoji: '‚åö', imagenes: ['‚åö', 'üèÉ', '‚ù§Ô∏è'], descripcionLarga: 'Toma el control de tu salud y tu actividad f√≠sica. Mide tu ox√≠geno en sangre, realiza un ECG en cualquier momento y registra todos tus entrenamientos con una precisi√≥n inigualable. Todo desde tu mu√±eca.', especificaciones: [{key: 'Sensores', value: 'ECG, SpO2, Ritmo Card√≠aco'}, {key: 'Resistencia al agua', value: '50 metros'}, {key: 'GPS', value: 'Integrado'}, {key: 'Material', value: 'Titanio aeroespacial'}] },
            { id: 6, marca: "LensMaster", nombre: 'C√°mara Profesional', precio: 3200.00, emoji: 'üì∑', imagenes: ['üì∑', 'üéûÔ∏è', 'Î†å'], descripcionLarga: 'Lleva tu fotograf√≠a y videograf√≠a al siguiente nivel. Con grabaci√≥n de video 4K, un sistema de estabilizaci√≥n de 5 ejes y la flexibilidad de los lentes intercambiables, no habr√° toma que se te resista.', especificaciones: [{key: 'Resoluci√≥n', value: '42.4MP Full-Frame'}, {key: 'Video', value: '4K a 120fps'}, {key: 'Estabilizaci√≥n', value: '5 ejes en el cuerpo'}, {key: 'Montura', value: 'Tipo E'}] }
        ];

        const SLIDER_PRODUCTS = [PRODUCTS[0], PRODUCTS[1], PRODUCTS[5]]; // Laptop, Smartphone, Camera

        let state = { cart: [], quoteList: [] };

        // =============================================
        // Slider Logic
        // =============================================
        let currentSlide = 0;
        let slideInterval;

        function renderSlider() {
            const sliderWrapper = document.querySelector('.slider-wrapper');
            const sliderDots = document.querySelector('.slider-dots');
            if (!sliderWrapper || !sliderDots) return;

            sliderWrapper.innerHTML = SLIDER_PRODUCTS.map(p => `
                <div class="slide" data-product-id="${p.id}">
                    <div class="slide-content">
                        <div class="slide-emoji">${p.imagenes[0]}</div>
                        <h2 class="slide-title">${p.nombre}</h2>
                        <p class="slide-description">${p.descripcionLarga.substring(0, 100)}...</p>
                        <button class="btn btn-primary" data-action="quick-view" style="width: auto;">Comprar Ahora</button>
                    </div>
                </div>
            `).join('');

            sliderDots.innerHTML = SLIDER_PRODUCTS.map((_, i) => `<div class="dot ${i === 0 ? 'active' : ''}" data-slide-to="${i}"></div>`).join('');
            
            startSliderInterval();
        }
        
        function showSlide(index) {
            const sliderWrapper = document.querySelector('.slider-wrapper');
            const dots = document.querySelectorAll('.dot');
            const totalSlides = SLIDER_PRODUCTS.length;

            if (index >= totalSlides) {
                currentSlide = 0;
            } else if (index < 0) {
                currentSlide = totalSlides - 1;
            } else {
                currentSlide = index;
            }

            sliderWrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
            dots.forEach(dot => dot.classList.remove('active'));
            dots[currentSlide].classList.add('active');
        }

        function nextSlide() { showSlide(currentSlide + 1); }
        function prevSlide() { showSlide(currentSlide - 1); }

        function startSliderInterval() {
            clearInterval(slideInterval);
            slideInterval = setInterval(nextSlide, 5000);
        }
        
        document.getElementById('hero-slider').addEventListener('click', (e) => {
            const target = e.target;
            if (target.closest('.next')) {
                nextSlide();
                startSliderInterval();
            } else if (target.closest('.prev')) {
                prevSlide();
                startSliderInterval();
            } else if (target.classList.contains('dot')) {
                const slideIndex = parseInt(target.dataset.slideTo, 10);
                showSlide(slideIndex);
                startSliderInterval();
            } else if (target.closest('[data-action="quick-view"]')) {
                const slide = target.closest('.slide');
                const productId = parseInt(slide.dataset.productId, 10);
                abrirModalDetalle(productId);
            }
        });
        // =============================================
        // Rest of the App Logic
        // =============================================

        function renderizarProductos() {
            const grid = document.getElementById('productosGrid');
            if (!grid) return;
            grid.innerHTML = PRODUCTS.map(p => `
                <div class="producto-card" data-product-id="${p.id}">
                    <div class="producto-imagen-wrapper" data-action="quick-view">
                        ${p.oferta ? `<div class="producto-oferta-badge">${p.oferta}</div>` : ''}
                        <div class="producto-imagen">${p.imagenes[0]}</div>
                    </div>
                    <div class="producto-content-wrapper">
                        <div class="producto-info">
                            <p class="producto-marca">${p.marca}</p>
                            <h3 class="producto-titulo" data-action="quick-view">${p.nombre}</h3>
                            <div class="producto-precio-wrapper">
                                <span class="producto-precio">S/ ${p.precio.toFixed(2)}</span>
                                ${p.precioAnterior ? `<span class="producto-precio-anterior">S/ ${p.precioAnterior.toFixed(2)}</span>` : ''}
                            </div>
                        </div>
                        <div class="producto-acciones-panel">
                            <button class="btn-add-cart-panel" data-action="add-to-cart">A√±adir al carrito</button>
                            <div class="acciones-panel-icons">
                                <button class="acciones-panel-btn" data-action="quick-view" aria-label="Vista r√°pida">${ICONS.quickView}</button>
                                <button class="acciones-panel-btn" data-action="add-to-quote" aria-label="A√±adir a cotizaci√≥n">${ICONS.quote}</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderizarContadores() {
            const cartCounter = document.getElementById('cart-counter');
            const quoteCounter = document.getElementById('quote-counter');
            const totalCartItems = state.cart.reduce((sum, item) => sum + item.cantidad, 0);
            const totalQuoteItems = state.quoteList.reduce((sum, item) => sum + item.cantidad, 0);
            
            cartCounter.textContent = totalCartItems;
            cartCounter.classList.toggle('visible', totalCartItems > 0);
            quoteCounter.textContent = totalQuoteItems;
            quoteCounter.classList.toggle('visible', totalQuoteItems > 0);
        }
        
        function renderizarListaModal(tipo) {
            const lista = tipo === 'compra' ? state.cart : state.quoteList;
            const titulo = tipo === 'compra' ? 'Tu Carrito de Compras' : 'Tu Lista de Cotizaci√≥n';
            const iconHeader = tipo === 'compra' ? ICONS.cart : ICONS.quote;

            if (lista.length === 0) {
                const ctaTexto = tipo === 'compra' ? 'Explorar Productos' : 'Ver Cat√°logo';
                return `
                    <button class="modal-close" data-action="close-modal">&times;</button>
                    <div class="modal-header">
                        <span class="nav-action-btn">${iconHeader}</span>
                        <h2 class="modal-titulo">${titulo}</h2>
                    </div>
                    <div class="lista-vacia">
                        <div class="lista-vacia-icon">${ICONS.bag}</div>
                        <p>Tu lista est√° vac√≠a.</p>
                        <p style="font-size: 1rem; margin-top: 10px; color: var(--text-color-light);">A√±ade productos para verlos aqu√≠.</p>
                        <button class="btn btn-primary" style="margin-top: 20px; width: auto;" data-action="close-modal">${ctaTexto}</button>
                    </div>`;
            }

            const itemsHTML = lista.map(item => `
                <div class="lista-item" data-item-id="${item.id}">
                    <div class="item-emoji">${item.emoji}</div>
                    <div class="item-info">
                        <h4>${item.nombre}</h4>
                        <p>S/ ${item.precio.toFixed(2)}</p>
                    </div>
                    <div class="item-controles">
                        <div class="cantidad-control">
                            <button class="cantidad-btn" data-action="update-qty" data-change="-1">${ICONS.minus}</button>
                            <input type="number" class="cantidad-input" value="${item.cantidad}" data-action="set-qty" />
                            <button class="cantidad-btn" data-action="update-qty" data-change="1">${ICONS.plus}</button>
                        </div>
                        <div class="item-precio">S/ ${(item.precio * item.cantidad).toFixed(2)}</div>
                        <button class="item-remove-btn" data-action="remove-item" aria-label="Eliminar item">${ICONS.trash}</button>
                    </div>
                </div>
            `).join('');
            
            const total = lista.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const botonTexto = tipo === 'compra' ? 'Proceder al Pago' : 'Solicitar Cotizaci√≥n';

            return `
                <button class="modal-close" data-action="close-modal">&times;</button>
                <div class="modal-header">
                    <span class="nav-action-btn">${iconHeader}</span>
                    <h2 class="modal-titulo">${titulo}</h2>
                </div>
                <div class="lista-items">${itemsHTML}</div>
                <div class="lista-footer">
                    <div class="lista-total">
                        <p>Total</p>
                        <h3>S/ ${total.toFixed(2)}</h3>
                    </div>
                    <div class="lista-acciones-footer">
                         <button class="btn btn-outline" data-action="close-modal">Seguir Comprando</button>
                         <button class="btn btn-primary" data-action="show-form">${botonTexto}</button>
                    </div>
                </div>`;
        }
        
        function renderizarFormularioModal(tipo) {
            const titulo = tipo === 'compra' ? 'Finalizar Compra' : 'Solicitar Cotizaci√≥n';
            const compraFormExtra = `
                <div class="form-group"><label>Modalidad de Entrega *</label><select name="modalidad_entrega" required><option value="">Seleccione...</option><option value="recojo">Recojo en Tienda</option><option value="envio">Env√≠o a Domicilio</option></select></div>
                <div class="form-group" id="direccionGroup" style="display: none;"><label>Direcci√≥n de Env√≠o *</label> <textarea name="direccion" rows="3"></textarea></div>
                <div class="form-group"><label>M√©todo de Pago *</label><select name="metodo_pago" required><option value="">Seleccione...</option><option value="yape">Yape</option><option value="plin">Plin</option><option value="transferencia">Transferencia Bancaria</option></select></div>
                <div id="infoYape" class="metodo-pago-info" style="display: none;"><h4>Pagar con Yape</h4><div class="qr-container"><div class="qr-placeholder">${ICONS.qr}<span>QR YAPE</span></div><p><strong>N√∫mero:</strong> 987 654 321</p><p><strong>Nombre:</strong> Qhatu51 SAC</p></div></div>
                <div id="infoPlin" class="metodo-pago-info" style="display: none;"><h4>Pagar con Plin</h4><div class="qr-container"><div class="qr-placeholder">${ICONS.qr}<span>QR PLIN</span></div><p><strong>N√∫mero:</strong> 987 654 321</p><p><strong>Nombre:</strong> Qhatu51 SAC</p></div></div>
                <div id="infoTransferencia" class="metodo-pago-info" style="display: none;"><h4>Datos para Transferencia</h4><div class="cuenta-info"><strong>BCP:</strong><p>Cuenta Corriente: 123-456789-0-12</p><p>CCI: 00212312345678901234</p></div><div class="cuenta-info"><strong>Interbank:</strong><p>Cuenta Corriente: 987-654321-0-98</p><p>CCI: 00398765432109876543</p></div><p style="margin-top: 10px;"><strong>Titular:</strong> Qhatu51 SAC</p></div>
                <div class="form-group"><label>N√∫mero de Operaci√≥n / Referencia</label><input type="text" name="referencia_pago"></div>`;
            const cotizacionFormExtra = `<div class="form-group"><label>Comentarios Adicionales</label><textarea name="comentarios" rows="3" placeholder="Cu√©ntanos m√°s sobre lo que necesitas..."></textarea></div>`;
            
            return `
                <button class="modal-close" data-action="close-modal">&times;</button>
                <div class="modal-header">
                    <button class="btn-back" data-action="show-list" aria-label="Volver a la lista">${ICONS.back}</button>
                    <h2 class="modal-titulo">${titulo}</h2>
                </div>
                <div class="form-container"><form id="form-${tipo}"><div class="form-group"><label>Nombre Completo *</label><input type="text" name="nombre" required></div><div class="form-group"><label>Tel√©fono (WhatsApp) *</label><input type="tel" name="telefono" required placeholder="51987654321"></div><div class="form-group"><label>Correo Electr√≥nico *</label><input type="email" name="correo" required></div>${tipo === 'compra' ? compraFormExtra : cotizacionFormExtra}<button type="submit" class="btn btn-primary" style="margin-top:10px;">${tipo === 'compra' ? 'Confirmar Compra' : 'Enviar Solicitud'}</button></form></div>`;
        }
        
        function renderizarModalDetalle(producto) {
            const especificacionesHTML = producto.especificaciones.map(spec => `<li><span>${spec.key}</span> <strong>${spec.value}</strong></li>`).join('');
            const miniaturasHTML = producto.imagenes.map((img, index) => `<div class="miniatura-item ${index === 0 ? 'active' : ''}" data-action="change-image" data-image="${img}">${img}</div>`).join('');

            return `
                <button class="modal-close" data-action="close-modal">&times;</button>
                 <div class="modal-header"><h2 class="modal-titulo">Vista R√°pida</h2></div>
                <div class="detalle-modal-layout">
                    <div class="detalle-galeria"><div class="imagen-principal" id="imagen-principal">${producto.imagenes[0]}</div><div class="miniatura-lista">${miniaturasHTML}</div></div>
                    <div class="detalle-info">
                        <p class="producto-marca">${producto.marca}</p>
                        <h2 class="producto-titulo" style="font-size: 2rem;">${producto.nombre}</h2>
                        <div class="producto-precio-wrapper">
                             <span class="producto-precio">S/ ${producto.precio.toFixed(2)}</span>
                             ${producto.precioAnterior ? `<span class="producto-precio-anterior">S/ ${producto.precioAnterior.toFixed(2)}</span>` : ''}
                        </div>
                        <p class="detalle-descripcion-larga">${producto.descripcionLarga}</p>
                        <div class="detalle-especificaciones"><h4>Especificaciones</h4><ul>${especificacionesHTML}</ul></div>
                        <div class="producto-acciones">
                             <button class="btn btn-primary" data-action="add-to-cart-from-detail">A√±adir al carrito</button>
                             <button class="btn btn-outline" data-action="add-to-quote-from-detail">Cotizar</button>
                        </div>
                    </div>
                </div>`;
        }
        
        function flyToCart(productCard) {
            const cartIcon = document.querySelector('[data-action="open-cart"]');
            const productImage = productCard.querySelector('.producto-imagen');
            if (!cartIcon || !productImage) return;
            
            const flyingImage = productImage.cloneNode(true);
            const rect = productImage.getBoundingClientRect();
            const cartRect = cartIcon.getBoundingClientRect();

            flyingImage.classList.add('flying-image');
            flyingImage.style.left = `${rect.left}px`;
            flyingImage.style.top = `${rect.top}px`;
            flyingImage.style.width = `${rect.width}px`;
            flyingImage.style.height = `${rect.height}px`;

            document.body.appendChild(flyingImage);

            requestAnimationFrame(() => {
                flyingImage.style.left = `${cartRect.left + cartRect.width / 2}px`;
                flyingImage.style.top = `${cartRect.top + cartRect.height / 2}px`;
                flyingImage.style.transform = 'scale(0.1)';
            });

            setTimeout(() => {
                flyingImage.remove();
            }, 600);
        }

        function agregarItem(tipo, productId, irALista = false) {
            const lista = tipo === 'compra' ? state.cart : state.quoteList;
            const producto = PRODUCTS.find(p => p.id === productId);
            if (!producto) return;

            const itemExistente = lista.find(item => item.id === productId);
            if (itemExistente) { itemExistente.cantidad++; } 
            else { lista.push({ ...producto, cantidad: 1 }); }
            
            if (irALista) { abrirModalLista(tipo); } 
            else { renderizarContadores(); }
        }

        function actualizarCantidad(tipo, itemId, cambio) {
            const lista = tipo === 'compra' ? state.cart : state.quoteList;
            const item = lista.find(i => i.id === itemId);
            if (!item) return;
            item.cantidad = Math.max(0, item.cantidad + cambio);
            if (item.cantidad === 0) { eliminarItem(tipo, itemId); } 
            else { abrirModalLista(tipo); }
        }
        
        function cambiarCantidadManualmente(tipo, itemId, nuevaCantidad) {
            const lista = tipo === 'compra' ? state.cart : state.quoteList;
            const item = lista.find(i => i.id === itemId);
            const cantidad = parseInt(nuevaCantidad, 10);
            if (item && cantidad > 0) { item.cantidad = cantidad; abrirModalLista(tipo); } 
            else if (item) { abrirModalLista(tipo); }
        }

        function eliminarItem(tipo, itemId) {
            if (tipo === 'compra') { state.cart = state.cart.filter(i => i.id !== itemId); } 
            else { state.quoteList = state.quoteList.filter(i => i.id !== itemId); }
            abrirModalLista(tipo);
        }

        async function handleFormSubmit(tipo, form) {
            const formData = new FormData(form);
            const lista = tipo === 'compra' ? state.cart : state.quoteList;
            
            const payload = {
                tipo, productos: lista,
                total: lista.reduce((sum, item) => sum + (item.precio * item.cantidad), 0),
                cliente: { nombre: formData.get('nombre'), telefono: formData.get('telefono'), correo: formData.get('correo') },
                fecha: new Date().toISOString(), estado: 'pendiente',
            };

            if (tipo === 'compra') {
                payload.entrega = { modalidad: formData.get('modalidad_entrega'), direccion: formData.get('direccion') || 'Recojo en tienda' };
                payload.pago = { metodo: formData.get('metodo_pago'), referencia: formData.get('referencia_pago') };
            } else { payload.comentarios = formData.get('comentarios'); }
            
            const url = tipo === 'compra' ? CONFIG.n8nWebhookCompra : CONFIG.n8nWebhookCotizacion;
            const successMessage = tipo === 'compra' ? '¬°Compra registrada! Te contactaremos pronto.' : '¬°Cotizaci√≥n solicitada! Te contactaremos en breve.';
            
            await enviarDatos(url, payload, successMessage);

            if (tipo === 'compra') { state.cart = []; } 
            else { state.quoteList = []; }
        }

        async function enviarDatos(url, payload, successMessage) {
            const modalContent = document.getElementById('modal-content');
            mostrarLoading(modalContent);
            try {
                console.log('Enviando:', payload);
                // Simulaci√≥n de llamada a API
                await new Promise(resolve => setTimeout(resolve, 1500));
                // const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                // if (!response.ok) throw new Error('Error en la respuesta del servidor');
                mostrarExito(modalContent, successMessage);
                setTimeout(() => cerrarModal(), 4000);
            } catch (error) {
                console.error('Error:', error);
                alert('Hubo un error al procesar tu solicitud. Por favor, intenta de nuevo.');
                cerrarModal();
            }
        }

        function abrirModalLista(tipo) {
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = renderizarListaModal(tipo);
            modalContent.dataset.type = tipo;
            modalContent.classList.add('size-md');
            modal.classList.add('active');
            renderizarContadores();
        }

        function abrirModalDetalle(productId) {
            const producto = PRODUCTS.find(p => p.id === productId);
            if (!producto) return;
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = renderizarModalDetalle(producto);
            modalContent.dataset.type = 'detalle';
            modalContent.dataset.productId = productId;
            modalContent.classList.remove('size-md');
            modal.classList.add('active');
        }

        function cerrarModal() {
            const modal = document.getElementById('modal');
            modal.classList.remove('active');
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = '';
            modalContent.classList.remove('size-md');
            renderizarContadores();
        }

        function mostrarLoading(container) { container.innerHTML = `<div class="loading"><div class="spinner"></div><p>Procesando tu solicitud...</p></div>`; }
        function mostrarExito(container, mensaje) { container.innerHTML = `<div class="success-message"><div class="success-icon">‚úÖ</div><h2>¬°√âxito!</h2><p>${mensaje}</p></div>`; }
        
        function initIcons() {
            document.getElementById('nav-cart-icon').innerHTML = ICONS.cart;
            document.getElementById('nav-quote-icon').innerHTML = ICONS.quote;
        }

        document.addEventListener('DOMContentLoaded', () => {
            initIcons();
            const savedState = localStorage.getItem('appState');
            if (savedState) { state = JSON.parse(savedState); }
            renderSlider();
            renderizarProductos();
            renderizarContadores();
        });
        
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('appState', JSON.stringify(state));
        });

        document.addEventListener('click', e => {
            const target = e.target;
            const actionTarget = target.closest('[data-action]');
            if (!actionTarget) return;

            const action = actionTarget.dataset.action;
            const productCard = target.closest('.producto-card');
            let productId = productCard ? parseInt(productCard.dataset.productId, 10) : null;
            const modalContent = document.getElementById('modal-content');
            const modalType = modalContent.dataset.type;
            const modalProductId = parseInt(modalContent.dataset.productId, 10);
            const listItem = target.closest('.lista-item');
            const itemId = listItem ? parseInt(listItem.dataset.itemId, 10) : null;
            
            // Handle actions from slider
            if (!productId) {
                 const slide = target.closest('.slide');
                 if(slide) {
                     productId = parseInt(slide.dataset.productId, 10);
                 }
            }
            
            if (action === 'open-cart') { abrirModalLista('compra'); return; }
            if (action === 'open-quote') { abrirModalLista('cotizacion'); return; }

            if (productId) {
                switch(action) {
                    case 'add-to-cart': 
                        agregarItem('compra', productId);
                        flyToCart(productCard);
                        renderizarContadores(); 
                        break;
                    case 'add-to-quote': agregarItem('cotizacion', productId); renderizarContadores(); break;
                    case 'quick-view': abrirModalDetalle(productId); break;
                }
            }

            if (document.getElementById('modal').classList.contains('active')) {
                switch(action) {
                    case 'close-modal': cerrarModal(); break;
                    case 'update-qty':
                        const change = parseInt(actionTarget.dataset.change, 10);
                        actualizarCantidad(modalType, itemId, change);
                        break;
                    case 'remove-item': eliminarItem(modalType, itemId); break;
                    case 'show-form': modalContent.innerHTML = renderizarFormularioModal(modalType); break;
                    case 'show-list': abrirModalLista(modalType); break;
                    case 'add-to-cart-from-detail': agregarItem('compra', modalProductId, true); break;
                    case 'add-to-quote-from-detail': agregarItem('cotizacion', modalProductId, true); break;
                    case 'change-image':
                        const mainImage = document.getElementById('imagen-principal');
                        if(mainImage) mainImage.innerHTML = actionTarget.dataset.image;
                        modalContent.querySelectorAll('.miniatura-item').forEach(el => el.classList.remove('active'));
                        actionTarget.classList.add('active');
                        break;
                }
            }
        });

        document.getElementById('modal-content').addEventListener('change', e => {
             const target = e.target;
             const tipo = document.getElementById('modal-content').dataset.type;
             if (!tipo) return;

             if (target.dataset.action === 'set-qty') {
                const listItem = target.closest('.lista-item');
                const itemId = parseInt(listItem.dataset.itemId, 10);
                cambiarCantidadManualmente(tipo, itemId, target.value);
             } else if (target.name === 'modalidad_entrega') {
                const form = target.closest('form');
                const direccionGroup = form.querySelector('#direccionGroup');
                if (direccionGroup) {
                    direccionGroup.style.display = target.value === 'envio' ? 'block' : 'none';
                    direccionGroup.querySelector('textarea').required = target.value === 'envio';
                }
             } else if (target.name === 'metodo_pago') {
                const form = target.closest('form');
                form.querySelectorAll('.metodo-pago-info').forEach(el => el.style.display = 'none');
                const selectedMethod = target.value;
                if (selectedMethod) {
                    const infoEl = form.querySelector(`#info${selectedMethod.charAt(0).toUpperCase() + selectedMethod.slice(1)}`);
                    if (infoEl) { infoEl.style.display = 'block'; }
                }
             }
        });

        document.getElementById('modal-content').addEventListener('submit', e => {
            e.preventDefault();
            const tipo = document.getElementById('modal-content').dataset.type;
            if (e.target.id === `form-${tipo}`) { handleFormSubmit(tipo, e.target); }
        });

    </script>
</body>
</html>